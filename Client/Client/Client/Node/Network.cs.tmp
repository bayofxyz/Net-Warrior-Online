using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Net.Sockets;
using System.Text;
using System.Threading;

namespace MMORPGCopierClient
{
    public class Network
    {
        private TcpClient client;
        public Network(TcpClient client)
        {
            this.client = client;
        }

        public void Connect(String ip, int port)
        {
            if (client != null && client.Connected)
                Close();
            client = null;
            client = new TcpClient();
            if (!client.Connected)
                client.Connect(ip, port);
        }

        public void Close()
        {
            if (client != null)
                client.Close();
        }

        public Boolean isConnected()
        {
            if (client == null)
                return false;
            return client.Connected;
        }

        public void Send(String message)
        {
            if (client.Connected)
            {
                Byte[] msg = System.Text.Encoding.UTF8.GetBytes(message);
                NetworkStream stream = client.GetStream();
                stream.Write(msg, 0, msg.Length);
                stream.Flush();
                //Debug.WriteLine("Send: " + message);
            }
        }

        public String Receive()
        {
            String responseMsg = "";
            if (client.Connected)
            {
                Byte[] msg = new Byte[256];
                NetworkStream stream = client.GetStream();
                if (stream.DataAvailable)
                {
                    int bytes = msg.Length;
                    while (bytes >= msg.Length)
                    {
                        bytes = stream.Read(msg, 0, msg.Length);
                        responseMsg += System.Text.Encoding.UTF8.GetString(msg, 0, bytes);
                    }
                }
            }
            //Debug.WriteLine("Receive: " + responseMsg);
            return responseMsg;
        }
    }
}
